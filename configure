#!/bin/bash
#
# acl configure script
#
boards=(
  generic
  lpc213x
  versatilepb
)

# default parameters
board="versatilepb"
cross_prefix=arm-none-eabi-
debug="yes"


containsElement () {
  local e
  for e in "${@:2}"; do [[ "$e" == "$1" ]] && return 0; done
  return 1
}

# parse options
for opt do
  optarg=`expr "x$opt" : 'x[^=]*=\(.*\)'`
  case "$opt" in
  --cross-prefix=*) cross_prefix="$optarg"
  ;;
  --enable-debug) debug="yes"
  ;;
  --disable-debug) debug="no"
  ;;
  --board=*) board="$optarg"
  ;;
  esac
done

if ! containsElement "$board" "${boards[@]}"
then
  echo "Invalid board: $board"
  echo "Supported boards are: ${boards[*]}"
  exit 1
fi

gcc="$cross_prefix"gcc
if ! type "$gcc" >/dev/null 2>&1
then
  echo "Invalid cross-compilation prefix: $cross_prefix"
  echo "Please check that $gcc is in your \$PATH and try again"
  exit 1
fi

# make source path absolute
source_path=`cd "$source_path"; pwd`

config_mk="config.mk"

echo "# Automatically generated by configure - do not modify" > $config_mk
printf "# Configured with:" >> $config_mk
printf " '%s'" "$0" "$@" >> $config_mk
echo >> $config_mk
echo "CROSS_COMPILE=$cross_prefix" >> $config_mk
echo "DEBUG=$debug" >> $config_mk
echo "BOARD=$board" >> $config_mk

echo "CROSS_COMPILE     $cross_prefix"
echo "DEBUG             $debug"
echo "BOARD             $board"
